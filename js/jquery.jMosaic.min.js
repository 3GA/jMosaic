(function(b){b.fn.jMosaic=function(p){function l(a,c,f,h){var j=a.find(c).outerHeight(!0),g=a.width()-1,d=0,k=0,e=0,d=j/h*g;a.find(c).each(function(){b(this).width(n(b(this),d-2*f));k+=b(this).outerWidth(!0)});a.find(c).height(d-2*f);e=a.find(c).last().outerWidth(!0)+(g-k)-2*f;a.find(c).last().width(e)}function n(a,b){var f="undefined"!=typeof a.attr("width")?a.attr("width"):a.width(),h="undefined"!=typeof a.attr("height")?a.attr("height"):a.height();return Math.round(b*(f/h))}var j=b.extend({items_type:"img",
min_row_height:150,margin:0,is_first_big:!1},p);return this.each(function(){var a=b(this);a.find(".jMosaic-item").each(function(){b(this)[0].className=b(this)[0].className.replace(/\bjMosaic-row_.*?\b/g,"")});a.find(".jMosaic-item").removeClass("jMosaic-item");a.removeClass("jMosaic-selector");var c=b(this),a=j.items_type,f=j.min_row_height,h=j.margin,m=j.is_first_big,g=0,d=0,k=c.find(a).length;if(m){var e=c.find(a),e=b.makeArray(e);e.reverse();b(c).html(e)}c.addClass("jMosaic-selector");c.find(a).each(function(a){b(this).addClass("jMosaic-item");
var e=n(b(this),f);b(this).removeAttr("width").removeAttr("height").css({width:e+"px",height:f+"px",margin:h+"px"});0==a?(d+=b(this).outerWidth(!0),g++):b(this).position().top!=b(this).prev().position().top?(l(c,".jMosaic-row_"+g,h,d),d=b(this).outerWidth(!0),g++):d+=b(this).outerWidth(!0);b(this).addClass("jMosaic-row_"+g);a==k-1&&l(c,".jMosaic-row_"+g,h,d)});m&&(a=c.find(a),a=b.makeArray(a),a.reverse(),b(c).html(a));c.append("<div style='clear:both;'></div>")})}})(jQuery);